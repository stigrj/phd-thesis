\chapter{Chemistry}
\section{One-electron Schr\"{o}dinger equation}\label{sec:schrodinger}
The single-particle time-independent Schr\"{o}dinger equation is given as
\begin{equation}
    \label{eq:diff_schrodinger}
    -\frac{\hbar^2}{2m}\nabla^2\varphi(r) + V(r)\varphi(r) = E \varphi(r)
\end{equation}
where the wavefunction $\varphi$ describes the quantum state of a single 
particle under the influence of the external potential $V$. 

\subsection{Integral formulation}\label{sec:1_orb_int}
Although the differential form in Eq.~(\ref{eq:diff_schrodinger}) is most 
commonly used, it is not very well suited for solution in the multiwavelet 
basis \cite{Harrison}, and differential operators (in particular higher 
order operators) should be avoided in order to maintain high accuracy. 
Kalos \cite{Kalos} showed in 1962 that the Schr\"{o}dinger equation can 
be formulated as an integral equation, using the Helmholtz Green's functions 
of Eq.~(\ref{eq:greens_kernel}), switching to atomic units
\begin{align}
    \big[-\frac{1}{2}\nabla^2 + V(r)\big]\varphi(r) &= E \varphi(r)\\
    \big[-\nabla^2 - 2E\big]\varphi(r) &= -2V(r) \varphi(r)\\
    \varphi(r) &= -2\int H_{\mu}(r-r')V(r') \varphi(r') \ud r'\\
    \label{eq:int_schrodinger}
    \varphi &= -2 \hat{H}\big[V\varphi\big]
\end{align}
with $\mu = \sqrt{-2E}$. Eq.~(\ref{eq:int_schrodinger}) defines a fixed-point 
problem, and iterative solution techniques for the determination of the 
wavefunction $\varphi$ and its ''energy''Â $\mu$ are presented in section 
\ref{sec:iterative_solution}.

\subsection{Nuclear potential}
Relying on the Born-Oppenheimer approximation, the single-particle 
Schr\"{o}dinger equation Eq.~(\ref{eq:diff_schrodinger}) can be used to model 
simple one-electron molecular systems, like the hydrogen atom or the H$_2^+$ 
ion. For such systems we have a fixed electrostatic potential $V(r)$ arising 
from the nuclear charge(s) of the molecule. The analytical form of this 
potential is given by Coulombs law
\begin{equation}
    \label{eq:coulombs_law}
    V(r) = \sum_i^{N_{nuc}} \frac{Z_i}{\| r-R_i \|}
\end{equation}
where $Z_i$ and $R_i$ are the nuclear charges and positions, respectively. 
Dispite its simple form, Eq.~(\ref{eq:coulombs_law}) is problematic as it is 
not square integrable, and thus not well represented in the multiwavelet basis. 
Harrison et al. \cite{Harrison} circumvents this problem by introducing an 
approximate expression in terms of the error function
\begin{align}
    \label{eq:harrison_potential}
    V(r) &= \sum_i^{N_{nuc}} Z_i \frac{u(\| r-R_i \|/c_i)}{c_i}\\
    u(r) &= \frac{erf(r)}{r} + \frac{1}{3\sqrt{\pi}}(e^{-r^2} + 16e^{-4r^2})
\end{align}
where $c_i$ is a smoothing parameter that depends on the nuclear charge and 
the requested precision $\epsilon$. The important features of this smoothed 
potential is that the singularity at the nuclear positions is removed, 
while maintaining very high accuracy at long range. The short range cutoff 
is controlled by the smoothing parameter, which we choose to be the same as 
Harrison et al.\cite{Harrison} $c_i = (0.00435 \epsilon/Z_i^5)^{1/3}$.

\section{Density Functional Theory} \label{sec:DFT}
\subsection{Kohn-Sham equations}
For a closed shell system in Kohn-sham DFT the ground state electron density is given 
in terms of the occupied Kohn-Sham orbitals (open shell systems are 
treated in section \ref{sec:open_shell_KS})
\begin{equation}
    \rho(r) = 2 \sum_{i=1}^N |\varphi_i(r)|^2
\end{equation}
where the occupied orbitals are the $N$ lowest eigenfunctions of the 
Kohn-Sham operator
\begin{equation}
    \label{eq:KS-diff}
    \big[-\frac{1}{2}\nabla^2 + V_{eff}(r)\big] \varphi_i(r) = \epsilon_i \varphi_i(r)
\end{equation}
where the effective potential (defined below) depends implicitly on the 
orbitals through the density. This means that we have a non-linear problem with $N$ coupled 
equations that must be solved self-consistently.

\subsection{Integral formulation}
As for the one-electron problem, we want to rewrite the differential 
equations in Eq.~(\ref{eq:KS-diff}) into integral form in order to be 
solved using the multiwavelet basis. This can be done straightforwardly
by the procedure of section \ref{sec:1_orb_int} for each orbital separately, 
\begin{equation}
    \label{eq:KS-int}
    \varphi_i(r) = -2\int H_{\mu_i}(r-r')V_{eff}(r') \varphi_i(r') \ud r'
\end{equation}
and the equations are again solved iteratively
\begin{equation}
    \label{eq:KS-iter}
    \tilde{\varphi}^{n+1}_i = -2 \hat{H}^n\big[V^n_{eff}\varphi^n_i\big]
\end{equation}
although care must be taken in order to keep orthonormality between the 
orbitals. A simple iteration of all $N$ orbitals separately will not 
conserve the canonical character of the input orbitals, and all orbitals 
will eventually collapse into the lowest energy eigenfunction, unless 
orthogonality is explicitly enforced. There are different ways in which 
one can keep orthonormality, and these are discussed below. Note also the
iteration label on the effective potential, as this depends on the orbitals 
and must be updated in each iteration.

\subsection{Kohn-Sham potentials}
In the absence of any externally applied fields, there are three contributions 
to the effective potential in Kohn-Sham theory.
\begin{equation}
    \label{eq:eff_pot}
    V_{eff} = V_{nuc} + V_{coul} + V_{xc}
\end{equation}
In addition to the nuclear potential $V_{nuc}$ presented above, there is the 
classical Coulomb repulsion between the electrons $V_{coul}$ as well as the 
non-classical exchange-correlation potential $V_{xc}$. The Coulomb potential 
is described in terms of the Poisson equation, which is expressed in integral 
form using the Green's function of Eq.~(\ref{eq:greens_kernel})
\begin{equation}
    \label{eq:coulomb}
    V_{coul}(r) = \int P(r-r')\rho(r')\ud r'
\end{equation}
A highly efficient (linear scaling) and parallelized implementation of the 
solution to the Poisson equation in the multiwavelet basis has been presented 
in a previuos study\cite{mwpar}. 

The exchange-correlation potential is formally expressed in terms of the 
functional derivative of the exchange-correlation energy
\begin{equation}
    V_{xc} 	= \frac{\delta E_{xc}[\rho]}{\delta \rho} 
		= \frac{\delta}{\delta \rho} \int F_{xc}(\rho,|\nabla\rho|,\nabla^2\rho,\dots) \ud \rho
\end{equation}
which in the local density approximation (LDA) reduces to
\begin{equation}
    V_{xc} = \frac{\partial F_{xc}(\rho)}{\partial \rho}
\end{equation}
For the density functional approximations available, this differentiation can 
be done analytically, and the potential can be evaluated on the multiresolution 
grid. Specifically, we use the XCFun library provided by Ekstr\"{o}m et 
al.\cite{XCFun} which applies automatic differentiation to provide arbitrary 
order density functional response.

\subsection{Open shell systems} \label{sec:open_shell_KS}
The extension to open shell systems is straightforward. In the local spin 
density approximation (LSDA) we separate the orbitals into $\alpha$ and 
$\beta$ spins, with corresponding spin densities 
\begin{equation}
    \rho^{\sigma} (r) = \sum_{i=1}^{N_{\sigma}} |\phi_i^{\sigma}(r)|^2 \qquad \sigma = \alpha, \beta
\end{equation} 
where the different spin orbitals experience different effective potentials
\begin{equation}
    V_{eff}^{\sigma} = V_{nuc} + V_{coul} + V_{xc}^{\sigma} \qquad \sigma = \alpha, \beta
\end{equation}
All spin effects are included in the exchange-correlation potential, so the 
nuclear and Coulomb potentials are the same as in Eq.~(\ref{eq:eff_pot}), 
where the latter is obtained from the full ($\alpha + \beta$) electron density.

\section{Hartree-Fock Theory}\label{sec:HFT}

\pagebreak

